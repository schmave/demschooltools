@(meetings : List [ Meeting ], sm_charges : List [ Charge ], people : List[ Person ],
rules : List[ Rule ])

@import helper._

@main("JC database", "home", "jc") {

<script type="text/javascript">

var meeting_info = [ @Html(
	meetings.map( m => "{ date: \"" + Application.yymmddDate(m.date) +
			"\", link: \"" + routes.Application.viewMeeting(m.id) +
			"\", case_count: " + m.cases.size() + "}").mkString(",")) ];

function hasMeeting(date)
{
	var str_date = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();
	for (i in meeting_info) {
		if (meeting_info[i].date == str_date) {
			return [true, "", "" + meeting_info[i].case_count + " cases"];
		}
	}

	return [false, "", ""];
}

function meetingSelected(str_date, datepicker) {
	for (i in meeting_info) {
		if (meeting_info[i].date == str_date) {
			location.href = meeting_info[i].link;
		}
	}
}

$(function() {
	$("#month-picker").datepicker({
		minDate: new Date(2013, 8, 1),
		maxDate: new Date(2014, 6, 31),
		dateFormat: 'yy-m-d',
		constrainInput: true,
		beforeShowDay: hasMeeting,
		onSelect: meetingSelected
	})
});
</script>

<h3> Welcome to the JC database. Please fasten your seatbelt. </h3>

@if( sm_charges.size() > 0 ) {
	<h4>Charges referred to School Meeting</h4>
	<table class="table">
		<thead><th width="70">Case
			<th width="20">Person
			<th width="150">Rule
			<th width="70">Plea
			<th>Resolution Plan<th>Findings</thead>
	@for( c <- sm_charges ) {
		<tr><td>@c.the_case.case_number
			<td>@if(c.person != null) { @c.person.getDisplayName() } else { <i>No one</i> }
			<td>@if(c.rule != null) { @c.rule.title } else { <i>None</i> }
			<td>@c.plea
			<td>@c.resolution_plan
			<td>@c.the_case.findings
	}
	</table>

@if( Application.isCurrentUserEditor() ) {
	<a class="btn btn-primary" href="@routes.ApplicationEditing.enterSchoolMeetingDecisions">
	Record School Meeting decisions</a>
}
}

<p>

<div class="row">
<div class="col-xs-4">
<h4>Minutes</h4>
<div id="month-picker" style="padding-top: 25px"></div>
</div>

<div class="col-xs-4">
<h4>People</h4>
<div class="scroll-table">
<table class="table table-hover table-condensed">
<thead><th height=50 width=200>Person<th align=right width=50>Complaint count<th align=right width=50>Charge count</thead>
@for( p <- people ) {
	<tr><td width=200><a href="@routes.Application.viewPersonHistory(p.person_id)">@p.getDisplayName()</a>
	<td align=right width=50>@p.cases_written_up.size()
	<td align=right width=50>@p.charges.size()
}
</table>
</div>
</div>

<div class="col-xs-4">
<h4>Rules</h4>
<div class="scroll-table">
<table class="table table-hover table-condensed">
<thead><th height=50 width=250>Rule<th align=right width=50>Charge count</thead>
@for( r <- rules ) {
	<tr><td width=250><a href="@routes.Application.viewRuleHistory(r.id)">@r.title</a>
	<td align=right width=50>@r.charges.size()
}
</table>
</div>
</div>

</div>

}