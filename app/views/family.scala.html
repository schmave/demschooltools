@(p : Person, family_members: List[Person], comments: List[Comment])

@import helper._

@main(p.first_name + " " + p.last_name) {

@defining(if(family_members.size() >= 2){ "span3" } else {"span6"}) { size =>
<div class="row">
	<div class="@size">
	@person(p)
	</div>

	@for( family_member <- family_members ) {
		<div class="@size">@person(family_member)</div>
	}
</div>
}

<hr>
<div class="row">
<div class="span9">

@form(routes.Application.addComment(), args = 'id -> "comment_form") {
@for( tag <- p.tags ) {
	@if( tag.task_list != null ) {
		<div id="span4">
		<h4><a href="@routes.Application.viewTaskList(tag.task_list.id)">@tag.task_list.title</a></h4>
		@for( task <- tag.task_list.tasks ) {
			@defining( p.completedTask(task) ) { ct =>
				@if( ct != null ) {
					<input type="checkbox" class="task_checkbox" id="task_checkbox_@task.id" disabled checked/>
				} else {
					<input type="checkbox" class="task_checkbox" id="task_checkbox_@task.id"/>
				}
				<label for="task_checkbox_@task.id" style="display:inline">@task.title</label>
				@if( ct != null ) {
					<i>(@ct.comment.user.name, @Application.formatDate(ct.comment.created))</i>
				}
				<br>
			}
		}
		</div>
	}
}

<p><a href="javascript:$('#new_comment').show()">Add a comment</a>
<div id="new_comment" style="display: none;">
	<div style="float:left">I talked with
	<input type=hidden name="person" value="@p.person_id" />@p.first_name @p.last_name
	about:<br>
	<textarea name="message" style="width: 400px;" rows=5 ></textarea>
	<div id="comment_tasks" style="float:right;"></div>
	<textarea style="display:none" name="comment_task_ids" id="comment_task_ids"></textarea>
	<br><input type="submit" value="Save Comment">
	</div>
	<script type="text/javascript">
        $("#comment_form").ajaxForm({"complete" : function(response, status) {
										 $("#comments").prepend(response.responseText);
										 $("#new_comment textarea").val("");
										 $("#new_comment").hide();
                                         }});
    </script>
}
</div>
</div>

</div>
<div class="row">
<div class="span9" id="comments">
@for( c <- comments ) {
	@comment_fragment(c)
}
</div>
</div>

	</div>

}

