@(p : Person, history : PersonHistory, recent_rps : List[ Charge ])

@import helper._

<h3>@p.getDisplayName()'s recent RPs:</h3>

@if( recent_rps.size() == 0 ) {
<p>None. Go @p.getDisplayName()!
} else {
<table class="table">
<thead><tr><th>Day<th width=45%>Entry<th width=45%>Resolution Plan</tr></thead>
<tbody>
@for( c <- recent_rps ) {
<tr><td>@Application.formatDayOfWeek(c.the_case.meeting.date)
<td>@if(c.rule != null) { @c.rule.title } else { <i>unknown</i> }
<td>@c.resolution_plan
}
</tbody>
</table>
}

<h3>Rule violation counts</h3>
<table class="table sortable">
<thead><tr><th width=50% class="sorttable_alpha">Entry<th width=25% class="sorttable_school_mmdd">Most Recent Violation<th class="sorttable_numeric"># of violations</tr></thead>
<tbody>
@for( r <- history.rule_records ) {
	<tr><td width=50%>@if(r.rule != null) { @r.rule.title } else { <i>unknown</i> }
		<td>
		@if( r.most_recent_charge != null ) {
			@Application.formatDateShort(r.most_recent_charge)
		}
		<td align=right>@r.count</tr>
}
</tbody>
</table>

<h3>Case Details...</h3>
<ul class="nav nav-tabs">
  <li class="active"><a href="#byrule" data-toggle="tab">... by Entry</a></li>
  <li><a href="#bydate" data-toggle="tab">... by Date</a></li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane active" id="byrule">
	@defining( p.getChargesByRule() ) { charges_by_rule =>
		@for( (rule, charges) <- charges_by_rule ) {
			@if( rule != null ) {
				<h4 style="margin-top: 2em;">@rule.title</h4>
			}
			@for( c <- charges) {
				@historyCharge(c, false, false)
			}
		}
	}
	</div>

	<div class="tab-pane" id="bydate">
	<p>&nbsp;</p>
	@defining( p.getChargesInDateOrder() ) { charges =>
		@for( c <- charges) {
			@historyCharge(c, false, true)
		}
	}
	</div>
</div>

